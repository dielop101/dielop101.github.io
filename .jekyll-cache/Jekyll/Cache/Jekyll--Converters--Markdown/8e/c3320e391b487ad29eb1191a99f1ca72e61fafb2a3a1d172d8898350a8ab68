I"ü<p>Seguro que m√°s de una vez has puesto en duda la utilidad de los tests que realizas. Sientes que el tiempo dedicado es realmente alto en comparaci√≥n con el coste del desarrollo y, para colmo, tras pasar toda una jornada laboral realiz√°ndolos, esa controvertida m√©trica que tantos dolores de cabeza da, como es el <i>code average</i>, no sube m√°s del 20%‚Ä¶</p>

<p>Con este post, voy a contaros un patr√≥n que personalmente me ayud√≥ a quitar esa sensaci√≥n de ‚Äúpereza‚Äù a la hora de realizar pruebas unitarias.</p>

<h2 id="problemas-en-los-tests">Problemas en los tests</h2>
<ul>
  <li>No existe una estructura de c√≥digo base preparado. Y con c√≥digo incluyo ni siquiera existir proyecto creado</li>
  <li>Ficheros de c√≥digo enormes donde no se modulariza nada</li>
  <li>No se aplican ning√∫n tipo de estrategia ni arquitecturas conocidas</li>
  <li>Nombrado de los tests/variables sin contexto</li>
  <li>Duplicidad de c√≥digo</li>
</ul>

<p>La sensaci√≥n es que los tests est√°n un paso por detr√°s en cuanto a exigencia de calidad de c√≥digo con respecto al desarrollo funcional en s√≠.</p>

<p>Un patr√≥n de dise√±o que me ha ayudado a optimizar mis tiempos a la hora de realizar los tests y a mantener una limpieza y orden en el c√≥digo es el patr√≥n <b>ObjectMother</b>.</p>

<h2 id="objectmother">ObjectMother</h2>
<p>Su definici√≥n es sencilla: se basa en un sistema de retorno de objetos con caracter√≠sticas espec√≠ficas para pasar a nuestros componentes o servicios que vayamos a testear. Hablando en terminos de implementaci√≥n, se puede ver como una clase que retorna, normalmente mediante un patr√≥n Factory, objetos espec√≠ficos.</p>

<h2 id="mejoras">Mejoras</h2>
<ul>
  <li>Centralizar los objetos</li>
  <li>Delegar en un tercero la responsabilidad de crear los objetos</li>
  <li>Reducir la posibilidad de c√≥digo duplicado, ya que suele ser habitual compartir entre diferentes tests objetos con similares caracter√≠sticas</li>
  <li>Mejora la sint√°xis en el nombrado de los objetos</li>
  <li>Tener una estructura de c√≥digo base preparado, evitando el tener que crear de cero los datos</li>
</ul>

<h2 id="construcci√≥n">Construcci√≥n</h2>
<p>Dependiendo de lo complejo que sea nuestro entorno a testear, podemos tener:</p>
<ul>
  <li>De 1 a N ObjectMothers</li>
  <li>Desde 1 clase a 1 proyecto o N proyectos</li>
</ul>

<p>La decisi√≥n depender√° de c√≥mo se intuya que vaya a crecer el dominio de la aplicaci√≥n.</p>

<h2 id="ejemplo">Ejemplo</h2>
<p>Supongamos que tenemos un servicio que calcule el riesgo de dar un cr√©dito a una persona. Las especificaciones nos indican que:</p>
<ul>
  <li>Si no trabajas, el sistema devolver√° 50% de riesgo.</li>
  <li>En caso contrario, 0%</li>
</ul>

<p>Adem√°s, la edad tambi√©n afectar√° en el c√°lculo, ya que no trabajar teniendo una edad superior a 50 a√±os, incrementar√° el riesgo a 75%.</p>

<p>El servicio recibir√° una entidad <em>Person</em>, siendo uno de sus atributos <em>Age</em> y otro <em>HasJob</em>.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">class</span> <span class="nc">Person</span>
<span class="p">{</span>
	<span class="k">public</span> <span class="nf">Person</span><span class="p">(</span><span class="kt">bool</span> <span class="n">hasJob</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="n">HasJob</span> <span class="p">=</span> <span class="n">hasJob</span><span class="p">;</span>
		<span class="n">Age</span> <span class="p">=</span> <span class="n">age</span><span class="p">;</span>
	<span class="p">}</span>

	<span class="k">public</span> <span class="kt">int</span> <span class="n">Age</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
	<span class="k">public</span> <span class="kt">bool</span> <span class="n">HasJob</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>¬øC√≥mo ser√≠a nuestro ObjectMother de la entidad <em>Person</em>?</p>

<p>Crearemos una clase llamada <em>PersonMother</em> que contendr√° los m√©todos que devolver√°n objetos <em>Person</em>.</p>

<p>Una posibilidad ser√≠a tener un m√©todo que devuelva un objeto <em>Person</em> gen√©rico y que reciba como par√°metros si trabaja y su edad.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="n">Person</span> <span class="nf">CreatePerson</span><span class="p">(</span><span class="kt">bool</span> <span class="n">hasJob</span><span class="p">,</span> <span class="kt">int</span> <span class="n">age</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="k">new</span> <span class="nf">Person</span><span class="p">(</span><span class="n">hasJob</span><span class="p">,</span> <span class="n">age</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>A partir de este m√©todo, podemos tener una funci√≥n que devuelva una persona con trabajo.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="n">Person</span> <span class="nf">CreatePersonWithJob</span><span class="p">()</span>
<span class="p">{</span>
	<span class="k">return</span> <span class="nf">CreatePerson</span><span class="p">(</span><span class="k">true</span><span class="p">,</span> <span class="m">30</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>De nuevo, construiremos a partir de este segundo m√©todo otro que devuelva una persona sin trabajo y, sobre este m√©todo, otro nuevo que adem√°s tenga en cuenta una edad superior a 50.</p>

<div class="language-csharp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="n">Person</span> <span class="nf">CreatePersonWithoutJob</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="nf">CreatePersonWithJob</span><span class="p">();</span>
	<span class="n">person</span><span class="p">.</span><span class="n">HasJob</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">person</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">static</span> <span class="n">Person</span> <span class="nf">CreatePersonWithoutJobAndAgeRisk</span><span class="p">()</span>
<span class="p">{</span>
	<span class="kt">var</span> <span class="n">person</span> <span class="p">=</span> <span class="nf">CreatePersonWithoutJob</span><span class="p">();</span>
	<span class="n">person</span><span class="p">.</span><span class="n">Age</span> <span class="p">=</span> <span class="m">60</span><span class="p">;</span>

	<span class="k">return</span> <span class="n">person</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="conclusiones">Conclusiones</h2>
<p>Hay diferentes maneras de crear un ObjectMother, pero la esencia es la misma: centralizar y dar la funcionalidad necesaria para crear objetos con las caracter√≠sticas espec√≠ficas que el negocio requiera.</p>

<p>Cualquier duda o sugerencia, estoy disponible en mis redes sociales :)</p>
:ET